(function(d){d.fn.extend({tableExport:function(h){function u(l,d,a){var c="";d=k(l,d,a);l=null===d||""==d?"":d.toString();if(d instanceof Date)c=b.csvEnclosure+d.toLocaleString()+b.csvEnclosure;else if(d=b.csvEnclosure+b.csvEnclosure,c=l.replace(new RegExp(b.csvEnclosure.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),d),0<=c.indexOf(b.csvSeparator)||/[\r\n ]/g.test(c))c=b.csvEnclosure+c+b.csvEnclosure;return c}function k(l,a,c){l=d(l);content_data="true"==b.htmlContent?l.html().trim():l.text().trim().replace(/\u00AD/g,
"");"true"==b.escape&&(content_data=escape(content_data));"function"===typeof b.onCellData&&(content_data=b.onCellData(l,a,c,content_data));return content_data}function z(b,d,a){return d+"-"+a.toLowerCase()}function v(b,d,a){window.getComputedStyle?(d=d.replace(/([a-z])([A-Z])/,z),d=window.getComputedStyle(b,null).getPropertyValue(d)):d=b.currentStyle?b.currentStyle[d]:b.style[d];d=d.match(/\d+/);if(null!==d){d=d[0];var c=document.createElement("div");c.style.overflow="hidden";c.style.visibility=
"hidden";b.parentElement.appendChild(c);c.style.width=100+a;a=100/c.offsetWidth;b.parentElement.removeChild(c);return d*a}return 0}function n(b,d){var a=document.createElement("a");if(a){document.body.appendChild(a);a.style="display: none";a.download=b;a.href=d;if(document.createEvent)null==q&&(q=document.createEvent("MouseEvents")),q.initEvent("click",!0,!1),a.dispatchEvent(q);else if(document.createEventObject)a.fireEvent("onclick");else if("function"==typeof a.onclick)a.onclick();document.body.removeChild(a)}}
function p(b){var d="",a,c,e,f,g,h,k=0;b=b.replace(/\x0d\x0a/g,"\n");c="";for(e=0;e<b.length;e++)f=b.charCodeAt(e),128>f?c+=String.fromCharCode(f):(127<f&&2048>f?c+=String.fromCharCode(f>>6|192):(c+=String.fromCharCode(f>>12|224),c+=String.fromCharCode(f>>6&63|128)),c+=String.fromCharCode(f&63|128));for(b=c;k<b.length;)a=b.charCodeAt(k++),c=b.charCodeAt(k++),e=b.charCodeAt(k++),f=a>>2,a=(a&3)<<4|c>>4,g=(c&15)<<2|e>>6,h=e&63,isNaN(c)?g=h=64:isNaN(e)&&(h=64),d=d+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);return d}var b={csvSeparator:",",csvEnclosure:'"',onCellData:null,ignoreColumn:[],displayTableName:"false",theadSelector:"tr",tbodySelector:"tr",tableName:"myTableName",worksheetName:"xlsWorksheetName",type:"csv",dpi:0,pdfLeftMargin:20,escape:"false",htmlContent:"false",
consoleLog:"false",outputMode:"file",fileName:"tableExport",excelstyles:["border-bottom","border-top","border-left","border-right"]};h=d.extend(!0,b,h);var q=null;if("csv"==b.type||"txt"==b.type){var c="",f=0;d(this).find("thead").find(b.theadSelector).each(function(){c+="\n";d(this).filter(":visible").find("th").each(function(a,e){"none"!=d(this).css("display")&&"none"!=d(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(a)&&(c+=u(this,f,a)+b.csvSeparator)});f++;c=d.trim(c);c=d.trim(c).substring(0,
c.length-1)});d(this).find("tbody").find(b.tbodySelector).each(function(){c+="\n";d(this).filter(":visible").find("td").each(function(a,e){"none"!=d(this).css("display")&&"none"!=d(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(a)&&(c+=u(this,f,a)+b.csvSeparator)});f++;c=d.trim(c).substring(0,c.length-1)});"true"==b.consoleLog&&console.log(c);if("string"==b.outputMode)return c;if("base64"==b.outputMode)return p(c);try{var m=new Blob([("csv"==b.type?"\ufeff":"")+c],{type:"text/"+("csv"==
b.type?"csv":"plain")+";charset=utf-8"});saveAs(m,b.fileName+"."+b.type)}catch(A){n(b.fileName+"."+b.type,"data:text/"+("csv"==b.type?"csv":"plain")+";charset=utf-8,"+("csv"==b.type?"\ufeff":"")+encodeURIComponent(c))}}else if("sql"==b.type){f=0;c="INSERT INTO `"+b.tableName+"` (";d(this).find("thead").find(b.theadSelector).each(function(){d(this).filter(":visible").find("th").each(function(a,e){"none"!=d(this).css("display")&&"none"!=d(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(a)&&
(c+="'"+k(this,f,a)+"',")});f++;c=d.trim(c);c=d.trim(c).substring(0,c.length-1)});c+=") VALUES ";d(this).find("tbody").find(b.tbodySelector).each(function(){c+="(";d(this).filter(":visible").find("td").each(function(a,e){"none"!=d(this).css("display")&&"none"!=d(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(a)&&(c+="'"+k(this,f,a)+"',")});f++;c=d.trim(c).substring(0,c.length-1);c+="),"});c=d.trim(c).substring(0,c.length-1);c+=";";"true"==b.consoleLog&&console.log(c);if("string"==b.outputMode)return c;
if("base64"==b.outputMode)return p(c);try{m=new Blob([c],{type:"text/plain;charset=utf-8"}),saveAs(m,b.fileName+".sql")}catch(B){n(b.fileName+".sql","data:application/sql;charset=utf-8,"+encodeURIComponent(c))}}else if("json"==b.type){var w=[];d(this).find("thead").find(b.theadSelector).each(function(){var a=[],c=0;d(this).filter(":visible").find("th").each(function(e,f){"none"!=d(this).css("display")&&"none"!=d(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(e)&&a.push(k(this,c,e))});
c++;w.push(a)});var x=[];d(this).find("tbody").find(b.tbodySelector).each(function(){var a=[];d(this).filter(":visible").find("td").each(function(c,e){"none"!=d(this).css("display")&&"none"!=d(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(c)&&a.push(k(this,f,c))});f++;x.push(a)});h=[];h.push({header:w,data:x});var a=JSON.stringify(h);"true"==b.consoleLog&&console.log(a);if("string"==b.outputMode)return a;h=p(a);if("base64"==b.outputMode)return h;try{m=new Blob([a],{type:"application/json;charset=utf-8"}),
saveAs(m,b.fileName+".json")}catch(C){n(b.fileName+".json","data:application/json;charset=utf-8;base64,"+h)}}else if("xml"==b.type){var f=0,g='<?xml version="1.0" encoding="utf-8"?>',g=g+"<tabledata><fields>";d(this).find("thead").find(b.theadSelector).each(function(){d(this).filter(":visible").find("th").each(function(a,c){"none"!=d(this).css("display")&&"none"!=d(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(a)&&(g+="<field>"+k(this,f,a)+"</field>")});f++});var g=g+"</fields><data>",
r=1;d(this).find("tbody").find(b.tbodySelector).each(function(){g+='<row id="'+r+'">';var a=0;d(this).filter(":visible").find("td").each(function(c,e){"none"!=d(this).css("display")&&"none"!=d(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(c)&&(g+="<column-"+a+">"+k(this,f,c)+"</column-"+a+">");a++});r++;f++;g+="</row>"});g+="</data></tabledata>";"true"==b.consoleLog&&console.log(g);if("string"==b.outputMode)return g;h=p(g);if("base64"==b.outputMode)return h;try{m=new Blob([g],{type:"application/xml;charset=utf-8"}),
saveAs(m,b.fileName+".xml")}catch(D){n(b.fileName+".xml","data:application/xml;charset=utf-8;base64,"+h)}}else if("excel"==b.type||"doc"==b.type){var f=0,e="<table>";d(this).find("thead").find(b.theadSelector).each(function(){e+="<tr>";d(this).filter(":visible").find("th,td").each(function(a,c){if("none"!=d(this).css("display")&&"none"!=d(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(a)){e+="<td style='";for(var g in b.excelstyles)b.excelstyles.hasOwnProperty(g)&&(e+=b.excelstyles[g]+
": "+d(this).css(b.excelstyles[g])+";");e+="'>"+k(this,f,a)+"</td>"}});f++;e+="</tr>"});r=1;d(this).find("tbody").find(b.tbodySelector).each(function(){e+="<tr>";var a=0;d(this).filter(":visible").find("td").each(function(c,g){if("none"!=d(this).css("display")&&"none"!=d(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(c)){e+="<td style='";for(var h in b.excelstyles)b.excelstyles.hasOwnProperty(h)&&(e+=b.excelstyles[h]+": "+d(this).css(b.excelstyles[h])+";");d(this).is("[colspan]")&&
(e+="' colspan='"+d(this).attr("colspan"));e+="'>"+k(this,f,c)+"</td>"}a++});r++;f++;e+="</tr>"});b.displayTableName&&(e+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+k(d("<p>"+b.tableName+"</p>"))+"</td></tr>");e+="</table>";"true"==b.consoleLog&&console.log(e);a="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:"+b.type+"' xmlns='http://www.w3.org/TR/REC-html40'>";a+='<meta http-equiv="content-type" content="application/vnd.ms-'+b.type+'; charset=UTF-8">';
a=a+'<meta http-equiv="content-type" content="application/'+("excel"==b.type?"vnd.ms-excel":"msword");a+='; charset=UTF-8">';a+="<head>";"excel"==b.type&&(a+="\x3c!--[if gte mso 9]>",a+="<xml>",a+="<x:ExcelWorkbook>",a+="<x:ExcelWorksheets>",a+="<x:ExcelWorksheet>",a+="<x:Name>",a+=b.worksheetName,a+="</x:Name>",a+="<x:WorksheetOptions>",a+="<x:DisplayGridlines/>",a+="</x:WorksheetOptions>",a+="</x:ExcelWorksheet>",a+="</x:ExcelWorksheets>",a+="</x:ExcelWorkbook>",a+="</xml>",a+="<![endif]--\x3e");
a+="</head>";a+="<body>";a+=e;a+="</body>";a+="</html>";if("string"==b.outputMode)return a;h=p(a);if("base64"==b.outputMode)return h;var y="excel"==b.type?"xls":"doc";try{m=new Blob([a],{type:"application/vnd.ms-"+b.type}),saveAs(m,b.fileName+"."+y)}catch(E){n(b.fileName+"."+y,"data:application/vnd.ms-"+b.type+";base64,"+h)}}else if("png"==b.type)html2canvas(d(this),{onrendered:function(a){a=a.toDataURL();a=a.substring(22);for(var c=atob(a),d=new ArrayBuffer(c.length),e=new Uint8Array(d),f=0;f<c.length;f++)e[f]=
c.charCodeAt(f);try{var g=new Blob([d],{type:"image/png"});saveAs(g,b.fileName+".png")}catch(h){n(b.fileName+".png","data:image/png;base64,"+a)}}});else if("pdf"==b.type){var t=new jsPDF;h={dim:{w:v(d(this).get(0),"width","mm"),h:v(d(this).get(0),"height","mm")}};t.addHTML(d(this),b.pdfLeftMargin,0,h,function(){var a=t.output();"true"==b.consoleLog&&console.log(a);if("string"==b.outputMode)return a;a=p(a);if("base64"==b.outputMode)return a;try{var c=t.output("blob");saveAs(c,b.fileName+".pdf")}catch(d){n(b.fileName+
".pdf","data:application/pdf;base64,"+a)}})}}})})(jQuery);
